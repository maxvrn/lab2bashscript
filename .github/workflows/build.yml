name: Build Python Application for Linux

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version number'
        required: false
        default: '1.0'
  
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest
    name: Build on Ubuntu
    
    steps:
    - name:  Checkout code
      uses: actions/checkout@v4
    
    - name:  Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name:  Install PyInstaller
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
    
    - name:  Build executable
      run: |
        echo "–°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
        
        pyinstaller --onefile \
          --name "myapp" \
          --add-data "README.md:." \
          src/main.py
        
        echo " –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
        ls -lh dist/
    
    # –®–∞–≥ 5: –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤
    - name:  Create archive
      run: |
        cd dist
        
        # –°–æ–∑–¥–∞—ë–º –∞—Ä—Ö–∏–≤ —Å –¥–∞—Ç–æ–π
        BUILD_DATE=$(date +%Y%m%d)
        ARCHIVE_NAME="myapp-linux-$BUILD_DATE.tar.gz"
        
        # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º
        tar -czf "$ARCHIVE_NAME" myapp
        
        # –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        echo "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: myapp" > info.txt
        echo "–í–µ—Ä—Å–∏—è: ${{ github.event.inputs.version || '1.0' }}" >> info.txt
        echo "–î–∞—Ç–∞ —Å–±–æ—Ä–∫–∏: $(date)" >> info.txt
        echo "–ö–æ–º–º–∏—Ç: ${{ github.sha }}" >> info.txt
        
        echo " –°–æ–∑–¥–∞–Ω –∞—Ä—Ö–∏–≤: $ARCHIVE_NAME"
        ls -lh *.tar.gz
    
    - name:  Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: linux-application
        path: |
          dist/*.tar.gz
          dist/info.txt
        retention-days: 30
        
    - name:  Success notification
      run: |
        echo "üéâ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
        echo "üì¶ –ê—Ä—Ö–∏–≤ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç 'linux-application'"
        echo "üì• –°–∫–∞—á–∞—Ç—å –º–æ–∂–Ω–æ –≤–æ –≤–∫–ª–∞–¥–∫–µ Actions ‚Üí —ç—Ç–æ—Ç –∑–∞–ø—É—Å–∫ ‚Üí Artifacts"
